(function($){$.fn.kiketable_colsizable=function(o){o=$.extend({},$.fn.kiketable_colsizable.defaults,o);o.dragProxy=(o.dragProxy==="line")?false:true;this.filter("table:not(."+o.namespace+")").addClass(o.namespace).each(function(index){o.renderTime=new Date().getTime();var oTable=this,$Table=$(this),_Cols=oTable.getElementsByTagName("col");_Cols.length&&$(o.dragCells,this).each(function(index){if(!$(this).hasClass("kiketable-th")){$(this).addClass("kiketable-th").wrapInner('<div class="kiketable-th-text"></div>')}$('<div class="'+o.classHandler+'" title="'+o.title+'"></div>').prependTo(this).each(function(){this.td=this.parentNode;this.$td=$(this.td);this.col=_Cols[this.td.cellIndex]}).dblclick(function(){if(this.wtd==null){this.wtd=this.col.offsetWidth;this.wtd0=this.wtd}var minimized=this.wtd==o.minWidth;this.wtd=(minimized)?this.wtd0:o.minWidth;this.col.style.width=this.wtd+"px";if(!o.fixWidth){var d=this.wtd0-o.minWidth;oTable.style.width=$Table.width()+((minimized)?d:-d)+"px"}$(this).trigger("minimized")}).bind("dragstart",function(e){this.cell_width=this.$td.width();this.table_width=$Table.width();this.left0=e.offsetX;this.d1=this.cell_width-this.left0;this.d2=o.minWidth-this.d1;return $(this).clone().appendTo(this.td).css("opacity",o.dragOpacity).css((o.dragProxy)?{top:this.$td.offset().top,left:this.$td.offset().left,width:this.cell_width}:{top:this.$td.offset().top,left:e.offsetX}).removeClass(o.classHandler).addClass((o.dragProxy)?o.classDragArea:o.classDragLine).height($Table.height())}).bind("drag",(o.dragMove||o.dragProxy)?function(e){var w=e.offsetX+this.d1;if(w-this.d2-this.d1>=0){e.dragProxy.style.width=w+"px";if(o.dragMove){this.col.style.width=w+"px";if(!o.fixWidth){oTable.style.width=(this.table_width-this.cell_width+w)+"px"}}}}:function(e){var x=e.offsetX;if(x-this.d2>=0){e.dragProxy.style.left=x+"px"}}).bind("dragend",function(e){if(!o.dragMove){var delta=parseInt(e.dragProxy.style.left)-this.left0;this.col.style.width=(o.dragProxy)?e.dragProxy.style.width:(this.cell_width+delta)+"px";if(!o.fixWidth){oTable.style.width=((o.dragProxy)?this.table_width-this.cell_width+parseInt(e.dragProxy.style.width):this.table_width+delta)+"px"}}$(e.dragProxy)[o.fxHide](o.fxSpeed,function(){$(this).remove()});$(this).trigger("minimized")}).bind("minimized",function(e){$(this.col)[(parseInt(this.col.style.width)<=o.minWidth)?"addClass":"removeClass"](o.classMinimized)})});o.renderTime=new Date().getTime()-o.renderTime;o.onLoad()});return this};$.fn.kiketable_colsizable.defaults={dragCells:"tr:first > *",dragMove:true,dragProxy:"line",dragOpacity:0.3,minWidth:8,fixWidth:false,fxHide:"fadeOut",fxSpeed:200,namespace:"kiketable-colsizable",classHandler:"kiketable-colsizable-handler",classDragLine:"kiketable-colsizable-dragLine",classDragArea:"kiketable-colsizable-dragArea",classMinimized:"kiketable-colsizable-minimized",title:"Expand/Collapse this column",renderTime:0,onLoad:function(){}}})(jQuery);